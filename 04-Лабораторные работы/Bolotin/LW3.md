# Практическая работа №3
### Установка и настройка DHCP сервера

**Выполнил:** Болотин Максим Владимирович

___
### Введение
Для успешной работы необходимы:
* Основная ОС Windows
* Установленный Virtual Box
* Виртуальный Linux Ubuntu Server
* Две виртуальные Linux Ubuntu Desktop
* Доступ в интернет

### Подготовка
Выставляем в настройках сети всех машин в *Типе подключения* "Внутренняя сеть"
![Скриншот01](https://i.ibb.co/sJy214B/01.jpg)
[Скриншот 1: настройки сети ВМ](https://i.ibb.co/sJy214B/01.jpg)

Запускаем обе UbuntuDsk и открываем настройки -> параметр *Сеть*, жмем на звездочку и во вкладке *IPv4* ставим метод "Вручную" и у машин с прошлой Лабораторной работы остались Адреса и Маска подсети (как на скриншоте) 

![Скриншот02](https://i.ibb.co/L895kKN/02.jpg)
[Скриншот 2: параметры IPv4 у первой ВМ](https://i.ibb.co/L895kKN/02.jpg)

![Скриншот03](https://i.ibb.co/zNLTBYN/03.jpg)
[Скриншот 3: параметры IPv4 у второй ВМ](https://i.ibb.co/zNLTBYN/03.jpg)

Проверим, что "Внутренняя сеть" работает следующим образом:
Запустим консоль на одной из машин и введем команду ping + адрес соседней машины, в данном случае так:
```
ping 192.168.2.2
```
![Скриншот04](https://i.ibb.co/Jmf90nB/04.jpg)
[Скриншот 4: процесс пингуляции соседней ВМ](https://i.ibb.co/Jmf90nB/04.jpg)

### Установка DHCP
Окей, "Внутренняя сеть" работает, можно приступить к установке DHCP
В консоли переходим в следующий каталог и пока сварачиваем его:
```
cd /etc/NetworkManager/system-connections/
```
![Скриншот05](https://i.ibb.co/wKtYYJm/05.jpg)
[Скриншот 5: путь в системную папку DHCP](https://i.ibb.co/wKtYYJm/05.jpg)

Теперь запускаем UbuntuSrv и для удобства переходим в PuTTY

![Скриншот06](https://i.ibb.co/NNcYGZy/06.jpg)
[Скриншот 6: запущеный UbuntuSrv](https://i.ibb.co/NNcYGZy/06.jpg)

Далее понадобится **[официальная документация по настройке DHCP на Ubuntu](https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D1%81%D0%B5%D1%82%D1%8C/dhcp)**
И находим команду для установки DHCP на сервер
```
sudo apt-get install isc-dhcp-server
```
![Скриншот07](https://i.ibb.co/mc3G9Hz/07.jpg)
[Скриншот 7: документация по установке и настройке DHCP на Ubnutu](https://i.ibb.co/mc3G9Hz/07.jpg)

Вводим и дожидаемся окончания установки

![Скриншот08](https://i.ibb.co/1MRH9R0/08.jpg)
[Скриншот 8: процесс установки DHCP на UbuntuSrv через PuTTY](https://i.ibb.co/1MRH9R0/08.jpg)


### Настройка DHCP
Возвращаемся на сайт и находим заголовок "Настройка"
Здесь нужно будет скопировать скрипт выдачи случайного IP-адреса

![Скриншот10](https://i.ibb.co/NLTMBPH/10.jpg)
[Скриншот 9: процесс установки DHCP на UbuntuSrv через PuTTY](https://i.ibb.co/NLTMBPH/10.jpg)

На UbuntuSrv нужно открыть на редактирование следующий файл для вставки скопированного скрипта
```
sudo vi /etc/dhcp/dhcpd.conf
```
![Скриншот11](https://i.ibb.co/q0zY5Y7/11.jpg)
[Скриншот 10: открытие на редактирование файл dhcpd.conf](https://i.ibb.co/q0zY5Y7/11.jpg)

Его нужно полностью очистить, для этого жмем *Esc* и зажимаем *d* для удаления всех строк

![Скриншот12](https://i.ibb.co/FhzQL0F/12.jpg)
[Скриншот 11: очистка файла dhcpd.conf](https://i.ibb.co/FhzQL0F/12.jpg)

Теперь, когда файл чист и с ним можно работать, переключаемся на UbunutDsk и и теперь ставим в *IPv4* метод "Автоматический"

![Скриншот14](https://i.ibb.co/mvv4d9D/14.jpg)
[Скриншот 12: метод "Автоматический" во вкладке IPv4 на первой ВМ](https://i.ibb.co/mvv4d9D/14.jpg)

![Скриншот15](https://i.ibb.co/MC4rDmD/15.jpg)
[Скриншот 15: метод "Автоматический" во вкладке IPv4 на первой ВМ](https://i.ibb.co/MC4rDmD/15.jpg)

В файл dhcpd.conf теперь скопированный код
```
default-lease-time 600;
max-lease-time 7200;

subnet 192.168.1.0 netmask 255.255.255.0 {
 range 192.168.1.150 192.168.1.200;
 option routers 192.168.1.254;
 option domain-name-servers 192.168.1.1, 192.168.1.2;
 option domain-name "mydomain.example";
} 
```
![Скриншот16](https://i.ibb.co/n3Dbjws/16.jpg)
[Скриншот 16: скрипт выдачи рандомного IP-адреса](https://i.ibb.co/n3Dbjws/16.jpg)

Теперь нужно изменить следующий файл
```
sudo vi /etc/netplank/00-installer-config.yaml
```
![Скриншот17](https://i.ibb.co/L58VwC2/21.jpg)
[Скриншот 17: переход в редактирование файла 00-installer-config.yaml](https://i.ibb.co/L58VwC2/21.jpg)

И вставляем данный код:
```
network:
    ethernets:
        enp0s3:
            dhcp4: false
            adresses: [192.168.1.1/24, ]
            gateway4: 192.168.1.1
    nameservers:
        addresses: [192.168.1.1, ]
    version: 2
```
![Скриншот18](https://i.ibb.co/SywCMGp/24.jpg)
[Скриншот 18: логика выдачи рандомного IP-адреса](https://i.ibb.co/SywCMGp/24.jpg)

И применяем настройки:
```
sudo netplan apply
```
![Скриншот19](https://i.ibb.co/NsnM1Y5/26.jpg)
[Скриншот 19: применение настроек](https://i.ibb.co/NsnM1Y5/26.jpg)

На крайний случай, если не сработало можно упрастить код

![Скриншот20](https://i.ibb.co/dpt1hdV/29.jpg)
[Скриншот 20: логика выдачи рандомного IP-адреса (упрощеная)](https://i.ibb.co/dpt1hdV/29.jpg)

Перезагружаем ВМ

![Скриншот21](https://i.ibb.co/HKYG5qH/33.jpg)
[Скриншот 21: перезагрузка UbuntuDsk](https://i.ibb.co/HKYG5qH/33.jpg)

И в настройках сети любуемся назначеным IP адресом на обоих машинах

![Скриншот22](https://i.ibb.co/Bqwr8xP/35.jpg)
[Скриншот 22: заданый IP-адрес на первой ВМ](https://i.ibb.co/Bqwr8xP/35.jpg)

![Скриншот23](https://i.ibb.co/XpfvdYw/36.jpg)
[Скриншот 23: заданый IP-адрес на второй ВМ](https://i.ibb.co/XpfvdYw/36.jpg)

### Вывод
Таким образом, можно без проблем положить начало локальной сети, автоматический выдавая IP-адреса под любую новую подключеную машину